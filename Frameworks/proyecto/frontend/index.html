<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Control Escolar ‚Äî Clases</title>
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <div class="top-bar">
        <div class="account-menu-wrapper">
            <button id="accountMenuBtn" class="account-menu-btn" title="Men√∫ de cuenta">üë§</button>
            <div id="accountMenu" class="account-menu hidden">
                <div class="account-menu-header" id="accountMenuHeader">Cuenta</div>
                <button id="manageAccount" class="account-menu-item" onclick="window.location.href='manage_account.html'">‚öôÔ∏è Gestionar</button>
                <hr style="margin: 0.5rem 0; opacity: 0.3;">
                <button id="logoutBtn" class="account-menu-item logout">üö™ Cerrar sesi√≥n</button>
            </div>
        </div>
        <button id="themeToggle" class="theme-toggle" aria-label="Alternar tema" title="Alternar tema">üåô</button>
    </div>

    <div class="container">
        <header class="app-header">
            <div class="header-left">
                <h1>Control de Clases</h1>
                <p class="subtitle">Interfaz para gestionar clases ‚Äî FastAPI</p>
            </div>
        </header>

        <main class="main-grid">
            <aside class="sidebar">
                <section id="accountCard" class="card form-account">
                    <h2>üë§ Cuenta</h2>
                    <form id="accountForm" class="form-vertical">
                        <div class="input-group">
                            <label for="userName">Usuario (requerido solo para registro)</label>
                            <input type="text" id="userName" placeholder="Nombre de usuario" />
                        </div>
                        <div class="input-group">
                            <label for="userMail">Correo *</label>
                            <input type="email" id="userMail" required placeholder="Correo electr√≥nico" />
                        </div>
                        <div class="input-group">
                            <label for="userPassword">Contrase√±a *</label>
                            <input type="password" id="userPassword" required placeholder="Contrase√±a" />
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">Iniciar / Registrar</button>
                        </div>
                    </form>
                </section>

                <section id="classCard" class="card form-section hidden">
                    <h2>üìö Crear / Actualizar Clase</h2>
                    <form id="productForm" class="form-vertical">
                        <div class="input-group">
                            <label for="itemId">ID</label>
                            <input type="number" id="itemId" min="1" placeholder="Identificador (ID)" />
                        </div>
                        <div class="input-group">
                            <label for="itemName">Nombre de la clase</label>
                            <input type="text" id="itemName" required placeholder="Nombre de la clase" />
                        </div>

                <div class="input-group">
                    <label>Parciales</label>
                    <div class="partials-controls">
                        <input type="text" id="itemPartial" placeholder="Nombre del parcial" />
                        <button type="button" id="addPartialBtn" class="btn btn-secondary btn-sm">‚ûï Agregar</button>
                    </div>
                    <ul id="partialsList" class="partials-list"></ul>
                </div>

                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary">üíæ Guardar clase</button>
                            <button type="button" id="cancelEditBtn" class="btn btn-secondary" style="display:none;">‚ùå Cancelar</button>
                        </div>
                    </form>
                </section>
            </aside>

            <section class="content">
                <div id="searchCard" class="card search-section hidden">
                    <h2>üîç Buscar Clase</h2>
                    <div class="search-controls">
                        <input type="number" id="searchId" placeholder="ID" min="1" />
                        <button type="button" id="searchBtn" class="btn btn-secondary">üîç Buscar</button>
                        <button type="button" id="verTodosBtn" class="btn btn-info">üìã Mis Clases</button>
                    </div>
                </div>

                <div id="resultsCard" class="card results-section hidden">
                    <h2>üìö Clases</h2>
                    <div id="results" class="results-container">
                        <p class="placeholder">Carga inicial... inicia sesi√≥n y pulsa "Mis Clases"</p>
                    </div>
                </div>
            </section>
        </main>

        <footer class="app-footer">
            <small>Interfaz para gestionar clase ‚Äî Alpha (Sujeto A Cambios)</small>
        </footer>

        <!-- Modal de confirmaci√≥n gen√©rica -->
        <div id="modal" class="modal hidden" aria-hidden="true">
            <div class="modal-content">
                <h3 id="modalTitle">Confirmar</h3>
                <p id="modalMessage">¬øEst√°s seguro?</p>
                <div class="modal-buttons">
                    <button id="modalConfirm" class="btn btn-danger">S√≠</button>
                    <button id="modalCancel" class="btn btn-secondary">Cancelar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para parciales -->
    <div id="partialModal" class="modal hidden">
        <div class="modal-content partial-modal-content">
            <div class="modal-header">
                <h3>Editar Parcial</h3>
                <button type="button" class="modal-close" onclick="closePartialModal()">‚úï</button>
            </div>
            
            <div class="partial-form">
                <div class="form-row">
                    <div class="form-col">
                        <label for="partialName">Nombre del parcial</label>
                        <input type="text" id="partialName" placeholder="Ej: Primer parcial" />
                    </div>
                    <div class="form-col">
                        <label for="partialMethod">M√©todo de evaluaci√≥n</label>
                        <select id="partialMethod">
                            <option value="promedio">Promedio</option>
                            <option value="suma">Suma</option>
                            <option value="ponderado">Ponderado</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="partialMaxScore">Calificaci√≥n m√°xima</label>
                        <input type="number" id="partialMaxScore" min="0" value="100" step="0.1" />
                    </div>
                    <div class="form-col">
                        <label for="partialVpfMax">L√≠mite VPF</label>
                        <input type="number" id="partialVpfMax" min="0" value="100" step="0.1" />
                    </div>
                </div>

                <div class="score-display">
                    <div class="score-item">
                        <span class="score-label">Promedio calculado:</span>
                        <span class="score-value" id="partialVpfDisplay">0.00</span>
                    </div>
                </div>

                <div class="performance-alert" id="performanceAlert" style="display: none;">
                    <span id="performanceAlertText"></span>
                </div>

                <div class="input-group">
                    <label>üìä Estructura de Calificaci√≥n (Porcentajes)</label>
                    <div class="categories-structure">
                        <div id="categoryItems" class="category-row"></div>
                        <div style="display:flex; gap:0.5rem; align-items:center; margin-top:0.5rem;">
                            <button type="button" id="addCategoryBtn" class="btn btn-secondary btn-sm">‚ûï Agregar categor√≠a</button>
                            <div class="category-total" style="margin-left:auto;">
                                <span>Total: <strong id="categoryTotal">100</strong>%</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="input-group">
                    <label>Penalizaciones y Extras</label>
                    <div class="penalty-extras-controls">
                        <input type="number" id="penaltyValue" placeholder="Cantidad" step="0.1" title="Penalizaci√≥n a restar" />
                        <input type="number" id="extraValue" placeholder="Cantidad" step="0.1" title="Puntos extras a sumar" />
                        <button type="button" id="addPenaltyBtn" class="btn btn-secondary" title="Agregar penalizaci√≥n">‚ûñ</button>
                        <button type="button" id="addExtraBtn" class="btn btn-secondary" title="Agregar extra">‚ûï</button>
                    </div>
                    <div id="penaltyExtrasDisplay" class="penalty-extras-display"></div>
                </div>

                <div class="input-group">
                    <label>Comparador de Periodos</label>
                    <select id="periodComparison" class="period-select">
                        <option value="none">Sin comparaci√≥n</option>
                        <option value="previous">Comparar con periodo anterior</option>
                        <option value="average">Promedio hist√≥rico</option>
                    </select>
                    <div id="comparisonResult" class="comparison-result hidden"></div>
                </div>

                <div class="activities-section">
                    <h4>Actividades</h4>
                    <div class="activities-container">
                        <ul id="partialActivities" class="activities-list"></ul>
                        <div id="activitiesEmpty" class="activities-empty">No hay actividades a√∫n</div>
                    </div>
                    <div id="effortCalcWrapper" class="effort-calc-wrapper">
                        <button type="button" id="calculateEffortBtn" class="btn btn-secondary btn-sm">üßÆ Calcular esfuerzo</button>
                        <div id="effortResult" class="effort-result" aria-live="polite">&nbsp;</div>
                    </div>
                </div>

                <div class="add-activity-section">
                    <h4>Agregar Actividad</h4>
                    <div class="activity-form-wrapper">
                        <div class="activity-input-row">
                            <div class="activity-input-row-extended">
                                <div style="display: flex; flex-direction: column; gap: 0.3rem;">
                                    <label for="activityName" style="font-size: 0.75rem; color: var(--muted); font-weight: 600;">Nombre</label>
                                    <input type="text" id="activityName" placeholder="Ej: Tarea 1" class="activity-input-name" />
                                </div><br>
                                <div style="display: flex; flex-direction: column; gap: 0.3rem;">
                                    <label for="activityDescription" style="font-size: 0.75rem; color: var(--muted); font-weight: 600;">Descripci√≥n</label>
                                    <textarea id="activityDescription" placeholder="Descripci√≥n opcional" class="activity-input-description" rows="2"></textarea>
                                </div><br>
                                <div style="display: flex; flex-direction: column; gap: 0.3rem;">
                                    <label for="activityScore" style="font-size: 0.75rem; color: var(--muted); font-weight: 600;">Calificaci√≥n</label>
                                    <input type="number" id="activityScore" class="activity-input-score" placeholder="0 - 100" step="0.1" />
                                </div><br>
                                <div style="display: flex; flex-direction: column; gap: 0.3rem;">
                                    <label for="activityWeight" style="font-size: 0.75rem; color: var(--muted); font-weight: 600;">Peso</label>
                                    <input type="number" id="activityWeight" class="activity-input-weight" value="1" min="0" step="0.1" />
                                </div><br>
                                <div style="display: flex; flex-direction: column; gap: 0.3rem;">
                                    <label for="activityCategory" style="font-size: 0.75rem; color: var(--muted); font-weight: 600;">Categor√≠a</label>
                                    <select id="activityCategory" class="activity-input-category">
                                        <option value="activities">Actividades</option>
                                        <option value="attendance">Asistencia</option>
                                        <option value="projects">Proyectos</option>
                                        <option value="exams">Ex√°menes</option>
                                    </select>
                                </div><br>
                                <div style="display:flex; align-items:flex-end; gap: 0.5rem;">
                                    <button type="button" id="addActivityBtn" class="btn btn-primary btn-add-activity">‚ûï Agregar actividad</button>
                                    <button type="button" id="cancelEditBtn" class="btn btn-secondary" style="display: none;">‚ùå Cancelar</button>
                                </div>
                                </div>
                            </div>

                        </div>
                        <div class="modal-footer" style="display:flex; gap:0.5rem; justify-content:flex-end; padding:0.75rem 1rem;">
                            <button id="partialModalCancel" class="btn btn-secondary">Cancelar</button>
                            <button id="partialModalSave" class="btn btn-primary">üíæ Guardar</button>
                        </div>
                    </div>
                </div>
            </div>

    <!-- Pantalla de carga -->
    <div id="loadingOverlay" class="loading-overlay hidden">
        <div class="loading-spinner">
            <div class="spinner"></div>
            <p>Cargando...</p>
        </div>
    </div>

    <script src="Scripts/utils.js"></script>
    <script src="Scripts/auth.js"></script>
    <script src="Scripts/partials.js"></script>
    <script src="Scripts/products.js"></script>
    <script src="Scripts/main.js"></script>
</body>
</html>